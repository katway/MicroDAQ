<?xml version="1.0" encoding="utf-8" ?>
<sqlMap>
  <statements>
    <select id="count_items">
      SELECT COUNT(*) FROM ProcessItem WHERE slave = #{slave}
    </select>
    <sql id="create_items">
      IF NOT EXISTS(SELECT * FROM ProcessItem WHERE slave = #{slave})
      BEGIN
      
        INSERT INTO ProcessItem (id, name, code, slave, type, updateRate, createTime)
        VALUES (#{id},#{name},#{code},#{slave},#{type},#{updateRate},GETDATE());

        EXEC proc_createProcessItemValue @processItemId = #{id};

        INSERT INTO ProcessItemState (processItemId, productionState, alertDelay, writeFlag, logic, minimum, maximum, yellowMin, yellowMax)
        VALUES     (#{id},1,null,1,null,null,null,null,null);

        INSERT INTO ProcessItemState (processItemId, productionState, alertDelay, writeFlag, logic, minimum, maximum, yellowMin, yellowMax)
        VALUES     (#{id},2,null,1,null,null,null,null,null);

        INSERT INTO ProcessItemState (processItemId, productionState, alertDelay, writeFlag, logic, minimum, maximum, yellowMin, yellowMax)
        VALUES     (#{id},3,null,1,null,null,null,null,null);

        INSERT INTO ProcessItemState (processItemId, productionState, alertDelay, writeFlag, logic, minimum, maximum, yellowMin, yellowMax)
        VALUES     (#{id},4,null,1,null,null,null,null,null);

        INSERT INTO ProcessItemState (processItemId, productionState, alertDelay, writeFlag, logic, minimum, maximum, yellowMin, yellowMax)
        VALUES     (#{id},5,null,1,null,null,null,null,null);

      END
    </sql>
  </statements>
</sqlMap>